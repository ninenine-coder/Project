<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase è¿æ¥æµ‹è¯•</title>
</head>
<body>
    <h1>Firebase è¿æ¥æµ‹è¯•</h1>
    <div id="status">æµ‹è¯•ä¸­...</div>
    <div id="scores"></div>

    <!-- 1. å…ˆè¼‰å…¥ firebase.js -->
    <script type="module" src="./js/firebase.js"></script>

    <script type="module">
        import { auth, db } from './js/firebase.js';
        import { collection, query, where, orderBy, getDocs, signInAnonymously as fbSignInAnonymously } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

        async function testFirebase() {
            const statusDiv = document.getElementById('status');
            const scoresDiv = document.getElementById('scores');
            
            try {
                console.log('ğŸ” å¼€å§‹ Firebase æµ‹è¯•...');
                statusDiv.textContent = 'Firebase åˆå§‹åŒ–æˆåŠŸ';
                
                // æµ‹è¯•åŒ¿åç™»å½•
                if (!auth.currentUser) {
                    console.log('ğŸ” å°è¯•åŒ¿åç™»å½•...');
                    await fbSignInAnonymously(auth);
                    console.log('âœ… åŒ¿åç™»å½•æˆåŠŸ:', auth.currentUser.uid);
                    statusDiv.textContent = 'Firebase åˆå§‹åŒ–æˆåŠŸï¼ŒåŒ¿åç™»å½•æˆåŠŸ';
                }
                
                // æµ‹è¯•æŸ¥è¯¢æˆç»©
                console.log('ğŸ” å¼€å§‹æŸ¥è¯¢æˆç»©...');
                const q = query(
                    collection(db, "scores"),
                    where("uid", "==", auth.currentUser.uid),
                    orderBy("submittedAt", "desc")
                );
                
                const querySnapshot = await getDocs(q);
                console.log('ğŸ“Š æŸ¥è¯¢ç»“æœæ•°é‡:', querySnapshot.size);
                
                if (querySnapshot.empty) {
                    scoresDiv.innerHTML = '<p>æ²¡æœ‰æ‰¾åˆ°æˆç»©è®°å½•</p>';
                    statusDiv.textContent += ' - æ²¡æœ‰æˆç»©è®°å½•';
                } else {
                    let html = '<h3>æˆç»©è®°å½•:</h3><ul>';
                    querySnapshot.forEach((doc) => {
                        const data = doc.data();
                        html += `<li>${data.score}åˆ† - ${data.examType || 'ç­†è©¦æ¸¬é©—'} - ${data.submittedAt?.toDate()?.toLocaleString() || 'ç„¡æ™‚é–“'}</li>`;
                    });
                    html += '</ul>';
                    scoresDiv.innerHTML = html;
                    statusDiv.textContent += ` - æ‰¾åˆ° ${querySnapshot.size} æ¡æˆç»©è®°å½•`;
                }
                
            } catch (error) {
                console.error('âŒ Firebase æµ‹è¯•å¤±è´¥:', error);
                statusDiv.textContent = 'Firebase æµ‹è¯•å¤±è´¥: ' + error.message;
                statusDiv.style.color = 'red';
            }
        }
        
        // é¡µé¢åŠ è½½åæ‰§è¡Œæµ‹è¯•
        document.addEventListener('DOMContentLoaded', testFirebase);
    </script>
</body>
</html>
