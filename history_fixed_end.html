        try {
          snap = await getDocs(q);
        } catch (e) {
          console.warn('orderBy(submittedAt) å¤±æ•—ï¼Œæ”¹ç”¨ä¸æ’åºï¼š', e.code || e.message);
          snap = await getDocs(
            query(collection(db, 'scores'), where('uid', '==', me.uid), limit(limitN))
          );
        }
        return snap.docs.map(d => ({ id: d.id, ...d.data() }));
      }

      function renderRows(rows) {
        if (!rows.length) {
          tbody.innerHTML = `<tr><td colspan="6" style="text-align:center;color:#666;padding:24px">ç›®å‰æ²’æœ‰ä»»ä½•æˆç¸¾ç´€éŒ„</td></tr>`;
          return;
        }
        tbody.innerHTML = rows.map(r => {
          const submitted = fmtTime(r.submittedAt);
          const title = r.examTitle || r.examId || r.examType || '(æœªå‘½å)';
          const dur = fmtDuration(r.timeSpentMs ?? r.durationMs ?? r.durationSec);
          return `<tr>
            <td class="exam-title">${title}</td>
            <td>${submitted}</td>
            <td>${scoreText(r)}</td>
            <td>${solvedText(r)}</td>
            <td>${dur}</td>
            <td><a class="btn" href="result.html?attemptId=${encodeURIComponent(r.id)}">æŸ¥çœ‹</a></td>
          </tr>`;
        }).join('');
      }

      async function main() {
        try {
          onAuthStateChanged(auth, (u) => {
            console.log('ğŸ” auth ç‹€æ…‹ï¼š', u ? (u.isAnonymous ? 'åŒ¿å-' + u.uid : (u.email || u.uid)) : 'æœªç™»å…¥');
          });

          const rows = await loadMyScores(50);
          renderRows(rows);
        } catch (e) {
          console.error('è¼‰å…¥æ­·å²æˆç¸¾å¤±æ•—ï¼š', e.code, e.message);
          tbody.innerHTML = `<tr><td colspan="6" style="text-align:center;color:#b91c1c;padding:24px">è®€å–å¤±æ•—ï¼š${e.code || e.message}</td></tr>`;
        }
      }

      main();
    </script>
</body>
</html>
