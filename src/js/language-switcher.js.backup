// 語言切換功能 - 用於 HTML 頁面
class LanguageSwitcher {
  constructor() {
    this.currentLang = localStorage.getItem('pbls_language') || 'zh';
    this.translations = {
      zh: {
        // 選單項目
        menu: {
          info: '資訊',
          practice: '練習專區',
          exam: '測驗專區',
          history: '歷史成績',
          team: '團隊'
        },
        // 頁面內容
        content: {
          // 通用內容
          pageTitle: '資訊 - PBLS VR教學平台',
          header: {
            title: '歡迎使用PBLS教學平台',
            userInfo: 'CGU(長庚大學), Nursing'
          },
          marquee: {
            item1: '🎯 歡迎使用PBLS VR教學平台！',
            item2: '📚 360°實境教學影片，身臨其境的學習體驗',
            item3: '🤖 情境模擬對話，提升急救溝通技巧',
            item4: '🎮 VR操作測驗，模擬真實急救情境',
            item5: '📊 即時成績追蹤，掌握學習進度',
            item6: '💡 問題導向學習法，提升急救技能'
          },
          // info.html
          hero: {
            title: '小兒基本生命支持（PBLS）',
            description: '小兒基本生命支持（PBLS）是專為兒童與嬰幼兒設計的重要急救流程，協助第一時間正確判斷並處理呼吸或心跳驟停的狀況。本平台提供完整的學習資源，涵蓋標準理論基礎、系統化流程操作與多情境模擬，透過圖解說明與互動式演練，幫助學員快速理解並熟練應變步驟，最終目標是讓每位學習者在關鍵時刻都能正確反應，提升急救成功率，守護孩子的生命安全',
            learnMore: '了解更多'
          },
          flowchart: {
            title: 'PBLS 流程圖',
            altText: 'PBLS流程圖',
            loadingText: 'PBLS流程圖圖片載入中...',
            loadingHint: '請確保圖片文件位於正確路徑'
          },
          scenarios: {
            title: '模擬情境案例',
            cardiac: '心臟驟停',
            foodPoisoning: '食物中毒',
            drowning: '溺水',
            fireInjury: '火災嗆傷',
            trauma: '外傷'
          },
          buttons: {
            practice: '立即練習模擬',
            exam: '進入考試測驗',
            treatment: '處理措施'
          },
          modal: {
            title: '處理措施',
            cardiac: {
              title: '心臟驟停處理措施',
              steps: [
                '立即檢查患者意識和呼吸',
                '呼叫急救服務 (119)',
                '開始心肺復甦術 (CPR)',
                '使用自動體外除顫器 (AED)',
                '持續CPR直到專業醫護人員到達'
              ]
            },
            foodPoisoning: {
              title: '食物中毒處理措施',
              steps: [
                '確保患者安全，遠離危險',
                '檢查患者意識和呼吸狀況',
                '清理氣道，移除異物',
                '進行人工呼吸或CPR',
                '呼叫急救服務並持續監護'
              ]
            },
            drowning: {
              title: '溺水處理措施',
              steps: [
                '安全地將患者救出水面',
                '檢查意識和呼吸',
                '清理氣道，移除水分',
                '開始心肺復甦術',
                '呼叫急救服務並保暖'
              ]
            },
            fireInjury: {
              title: '火災嗆傷處理措施',
              steps: [
                '立即遠離火源',
                '檢查患者呼吸狀況',
                '提供氧氣支持',
                '進行必要的呼吸道管理',
                '呼叫急救服務'
              ]
            },
            trauma: {
              title: '外傷處理措施',
              steps: [
                '確保現場安全',
                '評估患者傷勢',
                '控制出血',
                '固定受傷部位',
                '呼叫急救服務'
              ]
            }
          },
          // 其他頁面的標題
          pageTitle: {
            practice: '練習專區',
            exam: '測驗專區',
            history: '歷史成績',
            team: '團隊'
          },
          // 練習專區內容
          practice: {
            pageTitle: '練習專區 - PBLS VR教學平台',
            title: '練習專區',
            subtitle: '歡迎使用PBLS教學平台',
            description: '這裡提供 360° 實境教學影片與情境模擬對話學習。',
            vrVideo: {
              title: '360°實境教學影片',
              description: '沉浸式VR學習體驗,讓您身臨其境地學習急救技能',
              playButton: '播放VR影片'
            },
            virtualHuman: {
              title: '情境模擬對話',
              description: '與AI驅動的虛擬患者進行對話練習，提升溝通技巧'
            },
            quiz: {
              title: '練習題',
              description: '選擇題練習',
              startButton: '開始練習'
            }
          },
          // 測驗專區內容
          exam: {
            title: '測驗專區',
            subtitle: '歡迎使用PBLS教學平台',
            vrExam: {
              title: 'VR操作測驗',
              description: '虛擬實境環境中的急救操作測驗',
              startButton: '開始VR測驗'
            },
            writtenExam: {
              title: '筆試測驗',
              description: '20題選擇題，每題5秒鐘的時間作答，請把握寶貴的急救時間，正確做出應對措施',
              startButton: '開始筆試測驗'
            }
          },
          // 歷史成績內容
          history: {
            pageTitle: '歷史成績 - PBLS VR教學平台',
            title: '歷史成績',
            subtitle: '歡迎使用PBLS教學平台',
            description: '以下為每次練習與考試的紀錄：',
            table: {
              date: '日期',
              type: '類別',
              score: '分數'
            },
            practice: '練習',
            exam: '考試'
          },
          // 團隊內容
          team: {
            pageTitle: '團隊 - PBLS VR教學平台',
            title: '團隊成員',
            subtitle: '歡迎使用PBLS教學平台',
            description: '這裡展示團隊成員、角色與聯絡方式。',
            members: {
              member1: {
                name: '周哲旭',
                role: '職位'
              },
              member2: {
                name: '潘蓁樺',
                role: '職位'
              },
              member3: {
                name: '邱子芸',
                role: '職位'
              },
              member4: {
                name: '林立凡',
                role: '職位'
              }
            }
          },
          // 筆試測驗內容
          quiz: {
            pageTitle: '筆試測驗 - PBLS VR教學平台',
            header: {
              title: '歡迎使用PBLS教學平台',
              userInfo: 'CGU(長庚大學), Nursing'
            },
            marquee: {
              item1: '🎯 歡迎使用PBLS VR教學平台！',
              item2: '📚 360°實境教學影片，身臨其境的學習體驗',
              item3: '🤖 情境模擬對話，提升急救溝通技巧',
              item4: '🎮 VR操作測驗，模擬真實急救情境',
              item5: '📊 即時成績追蹤，掌握學習進度',
              item6: '💡 問題導向學習法，提升急救技能'
            },
            quiz: {
              title: '筆試測驗',
              description: '20題選擇題，每題5秒鐘的時間作答，請把握寶貴的急救時間，正確做出應對措施',
              startButton: '開始筆試測驗',
              exitConfirmation: '尚未完成筆試測驗，若現在離開測驗將不會記錄，確定是否離開？',
              results: {
                score: '分',
                correctAnswers: '答對題數',
                totalQuestions: '總題數',
                timeUsed: '用時',
                details: '測驗詳情',
                retakeButton: '重新測驗',
                correct: '正確',
                incorrect: '錯誤',
                noAnswer: '未作答',
                yourAnswer: '您的答案：',
                explanation: '解釋',
                correctAnswer: '正確答案'
              }
            }
          }
        },
        // 語言切換按鈕
        lang: {
          toggle: 'EN'
        }
      },
      en: {
        menu: {
          info: 'Information',
          practice: 'Practice',
          exam: 'Exam',
          history: 'History',
          team: 'Team'
        },
        content: {
          // 通用內容
          pageTitle: 'Information - PBLS VR Learning Platform',
          header: {
            title: 'Welcome to PBLS Learning Platform',
            userInfo: 'CGU (Chang Gung University), Nursing'
          },
          marquee: {
            item1: '🎯 Welcome to PBLS VR Learning Platform!',
            item2: '📚 360° Immersive Teaching Videos for Realistic Learning',
            item3: '🤖 Virtual Human Interaction to Improve Communication Skills',
            item4: '🎮 VR Practical Operations Simulating Real Emergency Situations',
            item5: '📊 Real-time Score Tracking to Monitor Learning Progress',
            item6: '💡 Problem-Based Learning to Enhance First Aid Skills'
          },
          // info.html
          hero: {
            title: 'Pediatric Basic Life Support (PBLS)',
            description: 'Pediatric Basic Life Support (PBLS) is the essential guideline for rescuing infants and children in cardiac or respiratory arrest. This platform provides systematic training combining theory, process flow, and scenario simulations.',
            learnMore: 'Learn More'
          },
          flowchart: {
            title: 'PBLS Flowchart',
            altText: 'PBLS Flowchart',
            loadingText: 'PBLS Flowchart image loading...',
            loadingHint: 'Please ensure the image file is in the correct path'
          },
          scenarios: {
            title: 'Simulation Scenario Cases',
            cardiac: 'Cardiac Arrest',
            foodPoisoning: 'Food Poisoning',
            drowning: 'Drowning',
            fireInjury: 'Fire Inhalation Injury',
            trauma: 'Trauma'
          },
          buttons: {
            practice: 'Practice Now',
            exam: 'Enter Exam Test',
            treatment: 'Treatment Measures'
          },
          modal: {
            title: 'Treatment Measures',
            cardiac: {
              title: 'Cardiac Arrest Treatment',
              steps: [
                'Immediately check patient consciousness and breathing',
                'Call emergency services (119)',
                'Begin cardiopulmonary resuscitation (CPR)',
                'Use automated external defibrillator (AED)',
                'Continue CPR until medical professionals arrive'
              ]
            },
            foodPoisoning: {
              title: 'Food Poisoning Treatment',
              steps: [
                'Ensure patient safety, remove from danger',
                'Check patient consciousness and breathing',
                'Clear airway, remove foreign objects',
                'Perform rescue breathing or CPR',
                'Call emergency services and continue monitoring'
              ]
            },
            drowning: {
              title: 'Drowning Treatment',
              steps: [
                'Safely rescue patient from water',
                'Check consciousness and breathing',
                'Clear airway, remove water',
                'Begin cardiopulmonary resuscitation',
                'Call emergency services and keep warm'
              ]
            },
            fireInjury: {
              title: 'Fire Inhalation Injury Treatment',
              steps: [
                'Immediately move away from fire source',
                'Check patient breathing condition',
                'Provide oxygen support',
                'Perform necessary airway management',
                'Call emergency services'
              ]
            },
            trauma: {
              title: 'Trauma Treatment',
              steps: [
                'Ensure scene safety',
                'Assess patient injuries',
                'Control bleeding',
                'Immobilize injured areas',
                'Call emergency services'
              ]
            }
          },
          pageTitle: {
            practice: 'Practice Area',
            exam: 'Exam Area',
            history: 'History',
            team: 'Team'
          },
          // 練習專區內容
          practice: {
            pageTitle: 'Practice Area - PBLS VR Learning Platform',
            title: 'Practice Area',
            subtitle: 'Welcome to PBLS Learning Platform',
            description: 'This section provides 360° immersive teaching videos and virtual human interaction learning.',
            vrVideo: {
              title: '360° Immersive Teaching Video',
              description: 'Immersive VR learning experience, allowing you to learn first aid skills in a realistic environment',
              playButton: 'Play VR Video'
            },
            virtualHuman: {
              title: 'Virtual Human Interaction',
              description: 'Practice dialogue with AI-driven virtual patients to improve communication skills'
            },
            quiz: {
              title: 'Practice Questions',
              description: 'Multiple Choice Practice',
              startButton: 'Start Practice'
            }
          },
          // 測驗專區內容
          exam: {
            title: 'Exam Area',
            subtitle: 'Welcome to PBLS Learning Platform',
            vrExam: {
              title: 'VR Practical Operation',
              description: 'First aid operation test in virtual reality environment',
              startButton: 'Start VR Exam'
            },
            writtenExam: {
              title: 'Written Test',
              description: '20 multiple choice questions, 5 seconds per question. Please make the most of your precious first aid time and respond correctly.',
              startButton: 'Start Written Test'
            }
          },
          // 歷史成績內容
          history: {
            pageTitle: 'History - PBLS VR Learning Platform',
            title: 'History',
            subtitle: 'Welcome to PBLS Learning Platform',
            description: 'Below are the records of each practice and exam:',
            table: {
              date: 'Date',
              type: 'Category',
              score: 'Score'
            },
            practice: 'Practice',
            exam: 'Exam'
          },
          // 團隊內容
          team: {
            pageTitle: 'Team - PBLS VR Learning Platform',
            title: 'Team Members',
            subtitle: 'Welcome to PBLS Learning Platform',
            description: 'This section displays team members, roles and contact information.',
            members: {
              member1: {
                name: 'Zhou Zhexu',
                role: 'Position'
              },
              member2: {
                name: 'Pan Zhenhua',
                role: 'Position'
              },
              member3: {
                name: 'Qiu Ziyun',
                role: 'Position'
              },
              member4: {
                name: 'Lin Lifan',
                role: 'Position'
              }
            }
          },
          // 筆試測驗內容
          quiz: {
            pageTitle: 'Written Test - PBLS VR Learning Platform',
            header: {
              title: 'Welcome to PBLS Learning Platform',
              userInfo: 'CGU(Chang Gung University), Nursing'
            },
            marquee: {
              item1: '🎯 Welcome to PBLS VR Learning Platform!',
              item2: '📚 360° immersive teaching videos for realistic learning experience',
              item3: '🤖 Virtual human interaction to improve first aid communication skills',
              item4: '🎮 VR practical operation simulating real first aid scenarios',
              item5: '📊 Real-time score tracking to monitor learning progress',
              item6: '💡 Problem-based learning approach to enhance first aid skills'
            },
            quiz: {
              title: 'Written Test',
              description: '20 multiple choice questions, 5 seconds per question. Please make the most of your precious first aid time and respond correctly.',
              startButton: 'Start Written Test',
              exitConfirmation: 'The written test is not completed yet. If you leave now, the test will not be recorded. Are you sure you want to leave?',
              results: {
                score: 'points',
                correctAnswers: 'Correct Answers',
                totalQuestions: 'Total Questions',
                timeUsed: 'Time Used',
                details: 'Test Details',
                retakeButton: 'Retake Test',
                correct: 'Correct',
                incorrect: 'Incorrect',
                noAnswer: 'No Answer',
                yourAnswer: 'Your answer: ',
                explanation: 'Explanation',
                correctAnswer: 'Correct Answer'
              }
            }
          }
        },
        lang: {
          toggle: '中'
        }
      }
    };
    
    this.init();
  }

  init() {
    this.applyLanguage(this.currentLang);
  }

  toggleLanguage() {
    const newLang = this.currentLang === 'zh' ? 'en' : 'zh';
    console.log('toggleLanguage: switching from', this.currentLang, 'to', newLang);
    this.currentLang = newLang;
    localStorage.setItem('pbls_language', newLang);
    this.applyLanguage(newLang);
  }

  applyLanguage(lang) {
    const translation = this.translations[lang];
    
    // 更新語言切換按鈕文字
    const languageButton = document.getElementById('language-text');
    if (languageButton) {
      languageButton.textContent = translation.lang.toggle;
    }

    // 更新選單項目文字
    this.updateMenuItems(translation.menu);

    // 根據當前頁面更新內容
    this.updatePageContent(translation.content);

    // 更新圖片路徑
    this.updateImages(lang);
  }

  updateMenuItems(menuTranslation) {
    const menuItems = [
      { selector: '[onclick*="info.html"] span', text: menuTranslation.info },
      { selector: '[onclick*="index.html"] span', text: menuTranslation.practice },
      { selector: '[onclick*="exam.html"] span', text: menuTranslation.exam },
      { selector: '[onclick*="history.html"] span', text: menuTranslation.history },
      { selector: '[onclick*="team.html"] span', text: menuTranslation.team }
    ];

    menuItems.forEach(item => {
      const element = document.querySelector(item.selector);
      if (element) {
        element.textContent = item.text;
      }
    });
  }

  updatePageContent(contentTranslation) {
    const currentPage = this.getCurrentPage();
    
    switch (currentPage) {
      case 'quiz':
        this.updateQuizPage(contentTranslation);
        break;
      case 'info':
        this.updateInfoPage(contentTranslation);
        break;
      case 'index':
        this.updateIndexPage(contentTranslation);
        break;
      case 'exam':
        this.updateExamPage(contentTranslation);
        break;
      case 'history':
        this.updateHistoryPage(contentTranslation);
        break;
      case 'team':
        this.updateTeamPage(contentTranslation);
        break;
    }
  }

  getCurrentPage() {
    const path = window.location.pathname;
    const href = window.location.href;
    console.log('getCurrentPage: path =', path, 'href =', href);
    
    if (path.includes('exam_quiz.html') || href.includes('exam_quiz.html')) {
      console.log('Detected quiz page');
      return 'quiz';
    }
    if (path.includes('info.html') || href.includes('info.html')) return 'info';
    if (path.includes('index.html') || href.includes('index.html')) return 'index';
    if (path.includes('exam.html') || href.includes('exam.html')) return 'exam';
    if (path.includes('history.html') || href.includes('history.html')) return 'history';
    if (path.includes('team.html') || href.includes('team.html')) return 'team';
    
    console.log('No specific page detected, returning default');
    return 'info'; // 默認
  }

  updateInfoPage(content) {
    // 更新頁面標題
    document.title = content.pageTitle;

    // 更新頂部標題
    const headerTitle = document.querySelector('.header-title');
    if (headerTitle) headerTitle.textContent = content.header.title;

    // 更新用戶信息
    const userInfo = document.querySelector('.user-info');
    if (userInfo) userInfo.textContent = content.header.userInfo;

    // 更新跑馬燈內容
    const marqueeItems = document.querySelectorAll('.marquee-item');
    if (marqueeItems.length >= 6) {
      marqueeItems[0].textContent = content.marquee.item1;
      marqueeItems[1].textContent = content.marquee.item2;
      marqueeItems[2].textContent = content.marquee.item3;
      marqueeItems[3].textContent = content.marquee.item4;
      marqueeItems[4].textContent = content.marquee.item5;
      marqueeItems[5].textContent = content.marquee.item6;
    }

    // Hero 區塊
    const heroTitle = document.querySelector('.hero-title');
    if (heroTitle) heroTitle.textContent = content.hero.title;

    const heroDescription = document.querySelector('.hero-description');
    if (heroDescription) heroDescription.textContent = content.hero.description;

    const learnMoreBtn = document.querySelector('.learn-more-btn');
    if (learnMoreBtn) learnMoreBtn.textContent = content.hero.learnMore;

    // 流程圖標題和相關內容
    const flowchartTitle = document.querySelector('.section-title');
    if (flowchartTitle) flowchartTitle.textContent = content.flowchart.title;

    const flowchartImg = document.querySelector('.flowchart-image img');
    if (flowchartImg) {
      flowchartImg.alt = content.flowchart.altText;
    }

    const loadingText = document.querySelector('.flowchart-image p');
    if (loadingText) loadingText.textContent = content.flowchart.loadingText;

    const loadingHint = document.querySelector('.flowchart-image p:nth-child(2)');
    if (loadingHint) loadingHint.textContent = content.flowchart.loadingHint;

    // 情境標題 - 使用正確的選擇器
    const scenariosTitle = document.querySelector('.section-purple .section-title');
    if (scenariosTitle) scenariosTitle.textContent = content.scenarios.title;

    // 情境卡片標題
    const scenarioTitles = document.querySelectorAll('.scenario-title');
    if (scenarioTitles.length >= 5) {
      scenarioTitles[0].textContent = content.scenarios.cardiac;
      scenarioTitles[1].textContent = content.scenarios.foodPoisoning;
      scenarioTitles[2].textContent = content.scenarios.drowning;
      scenarioTitles[3].textContent = content.scenarios.fireInjury;
      scenarioTitles[4].textContent = content.scenarios.trauma;
    }

    // 按鈕文字
    const practiceBtn = document.querySelector('.practice-btn');
    if (practiceBtn) practiceBtn.textContent = content.buttons.practice;

    const examBtn = document.querySelector('.exam-btn');
    if (examBtn) examBtn.textContent = content.buttons.exam;

    // 處理措施按鈕
    const treatmentBtns = document.querySelectorAll('.scenario-btn');
    treatmentBtns.forEach(btn => {
      btn.textContent = content.buttons.treatment;
    });

    // 更新模態框標題
    const modalTitle = document.getElementById('modalTitle');
    if (modalTitle) modalTitle.textContent = content.modal.title;
  }

  updateIndexPage(content) {
    // 更新頁面標題
    document.title = content.practice.pageTitle;

    // 練習專區頁面的翻譯
    const pageTitle = document.querySelector('.header-title');
    if (pageTitle) pageTitle.textContent = content.practice.subtitle;

    // 練習專區標題
    const practiceTitle = document.querySelector('.practice-homepage h1');
    if (practiceTitle) practiceTitle.textContent = content.practice.title;

    const practiceDesc = document.querySelector('.practice-homepage > p');
    if (practiceDesc) practiceDesc.textContent = content.practice.description;

    // VR 影片區塊
    const vrTitle = document.querySelector('.video-title span');
    if (vrTitle) vrTitle.textContent = content.practice.vrVideo.title;

    const vrSubtitle = document.querySelector('.video-subtitle');
    if (vrSubtitle) vrSubtitle.textContent = content.practice.vrVideo.description;

    // 虛擬人互動區塊
    const virtualHumanTitle = document.querySelector('.virtual-human-section h2');
    if (virtualHumanTitle) {
      virtualHumanTitle.innerHTML = `<i class="fas fa-comment-dots"></i> ${content.practice.virtualHuman.title}`;
    }

    const virtualHumanDesc = document.querySelector('.virtual-human-section p');
    if (virtualHumanDesc) virtualHumanDesc.textContent = content.practice.virtualHuman.description;

    // 跑馬燈內容
    const marqueeItems = document.querySelectorAll('.marquee-item');
    if (marqueeItems.length >= 6) {
      marqueeItems[0].textContent = content.marquee.item1;
      marqueeItems[1].textContent = content.marquee.item2;
      marqueeItems[2].textContent = content.marquee.item3;
      marqueeItems[3].textContent = content.marquee.item4;
      marqueeItems[4].textContent = content.marquee.item5;
      marqueeItems[5].textContent = content.marquee.item6;
    }
  }

  updateExamPage(content) {
    // 測驗專區頁面的翻譯
    const pageTitle = document.querySelector('.header-title');
    if (pageTitle) pageTitle.textContent = content.exam.subtitle;

    // 測驗專區標題
    const examTitle = document.querySelector('.exam-homepage h1');
    if (examTitle) examTitle.textContent = content.exam.title;

    const examDesc = document.querySelector('.exam-homepage > p');
    if (examDesc) examDesc.textContent = content.exam.subtitle;

    // 筆試卡片 (第一個)
    const writtenExamTitle = document.querySelector('.exam-option-card:nth-child(1) h3');
    if (writtenExamTitle) writtenExamTitle.textContent = content.exam.writtenExam.title;

    const writtenExamDesc = document.querySelector('.exam-option-card:nth-child(1) p');
    if (writtenExamDesc) writtenExamDesc.textContent = content.exam.writtenExam.description;

    const writtenExamBtn = document.querySelector('.exam-option-card:nth-child(1) .exam-btn');
    if (writtenExamBtn) writtenExamBtn.textContent = content.exam.writtenExam.startButton;

    // VR 考試卡片 (第二個)
    const vrExamTitle = document.querySelector('.exam-option-card:nth-child(2) h3');
    if (vrExamTitle) vrExamTitle.textContent = content.exam.vrExam.title;

    const vrExamDesc = document.querySelector('.exam-option-card:nth-child(2) p');
    if (vrExamDesc) vrExamDesc.textContent = content.exam.vrExam.description;

    const vrExamBtn = document.querySelector('.exam-option-card:nth-child(2) .exam-btn');
    if (vrExamBtn) vrExamBtn.textContent = content.exam.vrExam.startButton;

    // 跑馬燈內容
    const marqueeItems = document.querySelectorAll('.marquee-item');
    if (marqueeItems.length >= 6) {
      if (this.currentLang === 'en') {
        marqueeItems[0].textContent = '🎯 Welcome to PBLS VR Learning Platform!';
        marqueeItems[1].textContent = '📚 360° Immersive Teaching Videos for Realistic Learning';
        marqueeItems[2].textContent = '🤖 Virtual Human Interaction to Improve Communication Skills';
        marqueeItems[3].textContent = '🎮 VR Practical Operations Simulating Real Emergency Situations';
        marqueeItems[4].textContent = '📊 Real-time Score Tracking to Monitor Learning Progress';
        marqueeItems[5].textContent = '💡 Problem-Based Learning to Enhance First Aid Skills';
      } else {
        marqueeItems[0].textContent = '🎯 歡迎使用PBLS VR教學平台！';
        marqueeItems[1].textContent = '📚 360°實境教學影片，身臨其境的學習體驗';
        marqueeItems[2].textContent = '🤖 虛擬人互動，提升急救溝通技巧';
        marqueeItems[3].textContent = '🎮 VR操作測驗，模擬真實急救情境';
        marqueeItems[4].textContent = '📊 即時成績追蹤，掌握學習進度';
        marqueeItems[5].textContent = '💡 問題導向學習法，提升急救技能';
      }
    }
  }

  updateHistoryPage(content) {
    // 更新頁面標題
    document.title = content.history.pageTitle;

    // 歷史成績頁面的翻譯
    const pageTitle = document.querySelector('.header-title');
    if (pageTitle) pageTitle.textContent = content.history.subtitle;

    // 歷史成績標題
    const historyTitle = document.querySelector('.history-page h1');
    if (historyTitle) historyTitle.textContent = content.history.title;

    const historyDesc = document.querySelector('.history-page > p');
    if (historyDesc) historyDesc.textContent = content.history.description;

    // 表格標題
    const tableHeaders = document.querySelectorAll('.history-page table th');
    if (tableHeaders.length >= 3) {
      tableHeaders[0].textContent = content.history.table.date;
      tableHeaders[1].textContent = content.history.table.type;
      tableHeaders[2].textContent = content.history.table.score;
    }

    // 表格內容
    const tableCells = document.querySelectorAll('.history-page table td');
    if (tableCells.length >= 6) {
      // 第二行：練習
      tableCells[3].textContent = content.history.practice;
      // 第三行：考試
      tableCells[4].textContent = content.history.exam;
    }

    // 跑馬燈內容
    const marqueeItems = document.querySelectorAll('.marquee-item');
    if (marqueeItems.length >= 6) {
      marqueeItems[0].textContent = content.marquee.item1;
      marqueeItems[1].textContent = content.marquee.item2;
      marqueeItems[2].textContent = content.marquee.item3;
      marqueeItems[3].textContent = content.marquee.item4;
      marqueeItems[4].textContent = content.marquee.item5;
      marqueeItems[5].textContent = content.marquee.item6;
    }
  }

  updateQuizPage(content) {
    console.log('updateQuizPage called with content:', content);
    
    // 更新頁面標題
    document.title = content.quiz.pageTitle;
    console.log('Page title updated to:', content.quiz.pageTitle);

    // 更新頂部標題
    const headerTitle = document.querySelector('.header-title');
    if (headerTitle) {
      headerTitle.textContent = content.quiz.header.title;
      console.log('Header title updated to:', content.quiz.header.title);
    } else {
      console.log('Header title element not found');
    }

    // 更新用戶信息
    const userInfo = document.querySelector('.user-info');
    if (userInfo) {
      userInfo.textContent = content.quiz.header.userInfo;
      console.log('User info updated to:', content.quiz.header.userInfo);
    } else {
      console.log('User info element not found');
    }

    // 更新跑馬燈內容
    const marqueeItems = document.querySelectorAll('.marquee-item');
    if (marqueeItems.length >= 6) {
      marqueeItems[0].textContent = content.quiz.marquee.item1;
      marqueeItems[1].textContent = content.quiz.marquee.item2;
      marqueeItems[2].textContent = content.quiz.marquee.item3;
      marqueeItems[3].textContent = content.quiz.marquee.item4;
      marqueeItems[4].textContent = content.quiz.marquee.item5;
      marqueeItems[5].textContent = content.quiz.marquee.item6;
    }

    // 更新筆試測驗相關內容
    const quizTitle = document.querySelector('.quiz-title');
    if (quizTitle) quizTitle.textContent = content.quiz.quiz.title;

    const quizDescription = document.querySelector('.quiz-description');
    if (quizDescription) quizDescription.textContent = content.quiz.quiz.description;

    const startButton = document.querySelector('.start-quiz-btn');
    if (startButton) startButton.textContent = content.quiz.quiz.startButton;

    // 更新測驗結果相關文字（這些是動態生成的，需要在JavaScript中處理）
    // 這裡我們將更新全局變量，以便在生成結果時使用正確的語言
    window.quizTranslations = content.quiz.quiz.results;
    window.quizExitMessage = content.quiz.quiz.exitConfirmation;
    
    // 如果測驗尚未開始，重新載入對應語言的題目
    if (typeof loadQuestions === 'function' && !window.isQuizActive) {
      loadQuestions();
    }
    
    // 動態更新測驗描述，顯示實際題目數量
    updateQuizDescription();
  }

  updateQuizDescription() {
    // 這個函數會在 exam_quiz.html 中被定義和調用
    // 用於動態更新測驗描述文字
    if (typeof window.updateQuizDescriptionText === 'function') {
      window.updateQuizDescriptionText();
    }
  }

  updateTeamPage(content) {
    // 更新頁面標題
    document.title = content.team.pageTitle;

    // 團隊頁面的翻譯
    const pageTitle = document.querySelector('.header-title');
    if (pageTitle) pageTitle.textContent = content.team.subtitle;

    // 團隊標題
    const teamTitle = document.querySelector('.team-page h1');
    if (teamTitle) teamTitle.textContent = content.team.title;

    const teamDesc = document.querySelector('.team-page > p');
    if (teamDesc) teamDesc.textContent = content.team.description;

    // 團隊成員信息
    const memberCards = document.querySelectorAll('.team-member-card');
    if (memberCards.length >= 4) {
      // 周哲旭
      const member1Name = memberCards[0].querySelector('.member-name');
      const member1Role = memberCards[0].querySelector('.member-role');
      if (member1Name) member1Name.textContent = content.team.members.member1.name;
      if (member1Role) member1Role.textContent = content.team.members.member1.role;

      // 潘蓁樺
      const member2Name = memberCards[1].querySelector('.member-name');
      const member2Role = memberCards[1].querySelector('.member-role');
      if (member2Name) member2Name.textContent = content.team.members.member2.name;
      if (member2Role) member2Role.textContent = content.team.members.member2.role;

      // 邱子芸
      const member3Name = memberCards[2].querySelector('.member-name');
      const member3Role = memberCards[2].querySelector('.member-role');
      if (member3Name) member3Name.textContent = content.team.members.member3.name;
      if (member3Role) member3Role.textContent = content.team.members.member3.role;

      // 林立凡
      const member4Name = memberCards[3].querySelector('.member-name');
      const member4Role = memberCards[3].querySelector('.member-role');
      if (member4Name) member4Name.textContent = content.team.members.member4.name;
      if (member4Role) member4Role.textContent = content.team.members.member4.role;
    }

    // 跑馬燈內容
    const marqueeItems = document.querySelectorAll('.marquee-item');
    if (marqueeItems.length >= 6) {
      marqueeItems[0].textContent = content.marquee.item1;
      marqueeItems[1].textContent = content.marquee.item2;
      marqueeItems[2].textContent = content.marquee.item3;
      marqueeItems[3].textContent = content.marquee.item4;
      marqueeItems[4].textContent = content.marquee.item5;
      marqueeItems[5].textContent = content.marquee.item6;
    }
  }

  updateImages(lang) {
    // 流程圖圖片 - 暫時使用相同圖片，因為英文版本圖片不存在
    const flowchartImg = document.querySelector('.flowchart-image img');
    if (flowchartImg) {
      flowchartImg.src = '/PBLS流程圖.png';
    }

    // 情境圖片 - 使用相同的中文圖片，因為英文版本圖片不存在
    const scenarioImages = document.querySelectorAll('.scenario-image img');
    const scenarios = ['心臟驟停', '食物中毒', '溺水', '火災嗆傷', '外傷'];
    scenarioImages.forEach((img, index) => {
      if (scenarios[index]) {
        // 始終使用中文版本的圖片，因為英文版本圖片不存在
        img.src = `assets/${scenarios[index]}情境.png`;
      }
    });
  }
}

// 創建全局實例
window.languageSwitcher = new LanguageSwitcher();

// 全局函數供 HTML 調用
window.toggleLanguage = function() {
  window.languageSwitcher.toggleLanguage();
};

// 頁面載入時應用語言
document.addEventListener('DOMContentLoaded', function() {
  if (window.languageSwitcher) {
    window.languageSwitcher.applyLanguage(window.languageSwitcher.currentLang);
  }
});
