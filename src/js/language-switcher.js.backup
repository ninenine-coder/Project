// èªè¨€åˆ‡æ›åŠŸèƒ½ - ç”¨æ–¼ HTML é é¢
class LanguageSwitcher {
  constructor() {
    this.currentLang = localStorage.getItem('pbls_language') || 'zh';
    this.translations = {
      zh: {
        // é¸å–®é …ç›®
        menu: {
          info: 'è³‡è¨Š',
          practice: 'ç·´ç¿’å°ˆå€',
          exam: 'æ¸¬é©—å°ˆå€',
          history: 'æ­·å²æˆç¸¾',
          team: 'åœ˜éšŠ'
        },
        // é é¢å…§å®¹
        content: {
          // é€šç”¨å…§å®¹
          pageTitle: 'è³‡è¨Š - PBLS VRæ•™å­¸å¹³å°',
          header: {
            title: 'æ­¡è¿ä½¿ç”¨PBLSæ•™å­¸å¹³å°',
            userInfo: 'CGU(é•·åºšå¤§å­¸), Nursing'
          },
          marquee: {
            item1: 'ğŸ¯ æ­¡è¿ä½¿ç”¨PBLS VRæ•™å­¸å¹³å°ï¼',
            item2: 'ğŸ“š 360Â°å¯¦å¢ƒæ•™å­¸å½±ç‰‡ï¼Œèº«è‡¨å…¶å¢ƒçš„å­¸ç¿’é«”é©—',
            item3: 'ğŸ¤– æƒ…å¢ƒæ¨¡æ“¬å°è©±ï¼Œæå‡æ€¥æ•‘æºé€šæŠ€å·§',
            item4: 'ğŸ® VRæ“ä½œæ¸¬é©—ï¼Œæ¨¡æ“¬çœŸå¯¦æ€¥æ•‘æƒ…å¢ƒ',
            item5: 'ğŸ“Š å³æ™‚æˆç¸¾è¿½è¹¤ï¼ŒæŒæ¡å­¸ç¿’é€²åº¦',
            item6: 'ğŸ’¡ å•é¡Œå°å‘å­¸ç¿’æ³•ï¼Œæå‡æ€¥æ•‘æŠ€èƒ½'
          },
          // info.html
          hero: {
            title: 'å°å…’åŸºæœ¬ç”Ÿå‘½æ”¯æŒï¼ˆPBLSï¼‰',
            description: 'å°å…’åŸºæœ¬ç”Ÿå‘½æ”¯æŒï¼ˆPBLSï¼‰æ˜¯å°ˆç‚ºå…’ç«¥èˆ‡å¬°å¹¼å…’è¨­è¨ˆçš„é‡è¦æ€¥æ•‘æµç¨‹ï¼Œå”åŠ©ç¬¬ä¸€æ™‚é–“æ­£ç¢ºåˆ¤æ–·ä¸¦è™•ç†å‘¼å¸æˆ–å¿ƒè·³é©Ÿåœçš„ç‹€æ³ã€‚æœ¬å¹³å°æä¾›å®Œæ•´çš„å­¸ç¿’è³‡æºï¼Œæ¶µè“‹æ¨™æº–ç†è«–åŸºç¤ã€ç³»çµ±åŒ–æµç¨‹æ“ä½œèˆ‡å¤šæƒ…å¢ƒæ¨¡æ“¬ï¼Œé€éåœ–è§£èªªæ˜èˆ‡äº’å‹•å¼æ¼”ç·´ï¼Œå¹«åŠ©å­¸å“¡å¿«é€Ÿç†è§£ä¸¦ç†Ÿç·´æ‡‰è®Šæ­¥é©Ÿï¼Œæœ€çµ‚ç›®æ¨™æ˜¯è®“æ¯ä½å­¸ç¿’è€…åœ¨é—œéµæ™‚åˆ»éƒ½èƒ½æ­£ç¢ºåæ‡‰ï¼Œæå‡æ€¥æ•‘æˆåŠŸç‡ï¼Œå®ˆè­·å­©å­çš„ç”Ÿå‘½å®‰å…¨',
            learnMore: 'äº†è§£æ›´å¤š'
          },
          flowchart: {
            title: 'PBLS æµç¨‹åœ–',
            altText: 'PBLSæµç¨‹åœ–',
            loadingText: 'PBLSæµç¨‹åœ–åœ–ç‰‡è¼‰å…¥ä¸­...',
            loadingHint: 'è«‹ç¢ºä¿åœ–ç‰‡æ–‡ä»¶ä½æ–¼æ­£ç¢ºè·¯å¾‘'
          },
          scenarios: {
            title: 'æ¨¡æ“¬æƒ…å¢ƒæ¡ˆä¾‹',
            cardiac: 'å¿ƒè‡Ÿé©Ÿåœ',
            foodPoisoning: 'é£Ÿç‰©ä¸­æ¯’',
            drowning: 'æººæ°´',
            fireInjury: 'ç«ç½å—†å‚·',
            trauma: 'å¤–å‚·'
          },
          buttons: {
            practice: 'ç«‹å³ç·´ç¿’æ¨¡æ“¬',
            exam: 'é€²å…¥è€ƒè©¦æ¸¬é©—',
            treatment: 'è™•ç†æªæ–½'
          },
          modal: {
            title: 'è™•ç†æªæ–½',
            cardiac: {
              title: 'å¿ƒè‡Ÿé©Ÿåœè™•ç†æªæ–½',
              steps: [
                'ç«‹å³æª¢æŸ¥æ‚£è€…æ„è­˜å’Œå‘¼å¸',
                'å‘¼å«æ€¥æ•‘æœå‹™ (119)',
                'é–‹å§‹å¿ƒè‚ºå¾©ç”¦è¡“ (CPR)',
                'ä½¿ç”¨è‡ªå‹•é«”å¤–é™¤é¡«å™¨ (AED)',
                'æŒçºŒCPRç›´åˆ°å°ˆæ¥­é†«è­·äººå“¡åˆ°é”'
              ]
            },
            foodPoisoning: {
              title: 'é£Ÿç‰©ä¸­æ¯’è™•ç†æªæ–½',
              steps: [
                'ç¢ºä¿æ‚£è€…å®‰å…¨ï¼Œé é›¢å±éšª',
                'æª¢æŸ¥æ‚£è€…æ„è­˜å’Œå‘¼å¸ç‹€æ³',
                'æ¸…ç†æ°£é“ï¼Œç§»é™¤ç•°ç‰©',
                'é€²è¡Œäººå·¥å‘¼å¸æˆ–CPR',
                'å‘¼å«æ€¥æ•‘æœå‹™ä¸¦æŒçºŒç›£è­·'
              ]
            },
            drowning: {
              title: 'æººæ°´è™•ç†æªæ–½',
              steps: [
                'å®‰å…¨åœ°å°‡æ‚£è€…æ•‘å‡ºæ°´é¢',
                'æª¢æŸ¥æ„è­˜å’Œå‘¼å¸',
                'æ¸…ç†æ°£é“ï¼Œç§»é™¤æ°´åˆ†',
                'é–‹å§‹å¿ƒè‚ºå¾©ç”¦è¡“',
                'å‘¼å«æ€¥æ•‘æœå‹™ä¸¦ä¿æš–'
              ]
            },
            fireInjury: {
              title: 'ç«ç½å—†å‚·è™•ç†æªæ–½',
              steps: [
                'ç«‹å³é é›¢ç«æº',
                'æª¢æŸ¥æ‚£è€…å‘¼å¸ç‹€æ³',
                'æä¾›æ°§æ°£æ”¯æŒ',
                'é€²è¡Œå¿…è¦çš„å‘¼å¸é“ç®¡ç†',
                'å‘¼å«æ€¥æ•‘æœå‹™'
              ]
            },
            trauma: {
              title: 'å¤–å‚·è™•ç†æªæ–½',
              steps: [
                'ç¢ºä¿ç¾å ´å®‰å…¨',
                'è©•ä¼°æ‚£è€…å‚·å‹¢',
                'æ§åˆ¶å‡ºè¡€',
                'å›ºå®šå—å‚·éƒ¨ä½',
                'å‘¼å«æ€¥æ•‘æœå‹™'
              ]
            }
          },
          // å…¶ä»–é é¢çš„æ¨™é¡Œ
          pageTitle: {
            practice: 'ç·´ç¿’å°ˆå€',
            exam: 'æ¸¬é©—å°ˆå€',
            history: 'æ­·å²æˆç¸¾',
            team: 'åœ˜éšŠ'
          },
          // ç·´ç¿’å°ˆå€å…§å®¹
          practice: {
            pageTitle: 'ç·´ç¿’å°ˆå€ - PBLS VRæ•™å­¸å¹³å°',
            title: 'ç·´ç¿’å°ˆå€',
            subtitle: 'æ­¡è¿ä½¿ç”¨PBLSæ•™å­¸å¹³å°',
            description: 'é€™è£¡æä¾› 360Â° å¯¦å¢ƒæ•™å­¸å½±ç‰‡èˆ‡æƒ…å¢ƒæ¨¡æ“¬å°è©±å­¸ç¿’ã€‚',
            vrVideo: {
              title: '360Â°å¯¦å¢ƒæ•™å­¸å½±ç‰‡',
              description: 'æ²‰æµ¸å¼VRå­¸ç¿’é«”é©—,è®“æ‚¨èº«è‡¨å…¶å¢ƒåœ°å­¸ç¿’æ€¥æ•‘æŠ€èƒ½',
              playButton: 'æ’­æ”¾VRå½±ç‰‡'
            },
            virtualHuman: {
              title: 'æƒ…å¢ƒæ¨¡æ“¬å°è©±',
              description: 'èˆ‡AIé©…å‹•çš„è™›æ“¬æ‚£è€…é€²è¡Œå°è©±ç·´ç¿’ï¼Œæå‡æºé€šæŠ€å·§'
            },
            quiz: {
              title: 'ç·´ç¿’é¡Œ',
              description: 'é¸æ“‡é¡Œç·´ç¿’',
              startButton: 'é–‹å§‹ç·´ç¿’'
            }
          },
          // æ¸¬é©—å°ˆå€å…§å®¹
          exam: {
            title: 'æ¸¬é©—å°ˆå€',
            subtitle: 'æ­¡è¿ä½¿ç”¨PBLSæ•™å­¸å¹³å°',
            vrExam: {
              title: 'VRæ“ä½œæ¸¬é©—',
              description: 'è™›æ“¬å¯¦å¢ƒç’°å¢ƒä¸­çš„æ€¥æ•‘æ“ä½œæ¸¬é©—',
              startButton: 'é–‹å§‹VRæ¸¬é©—'
            },
            writtenExam: {
              title: 'ç­†è©¦æ¸¬é©—',
              description: '20é¡Œé¸æ“‡é¡Œï¼Œæ¯é¡Œ5ç§’é˜çš„æ™‚é–“ä½œç­”ï¼Œè«‹æŠŠæ¡å¯¶è²´çš„æ€¥æ•‘æ™‚é–“ï¼Œæ­£ç¢ºåšå‡ºæ‡‰å°æªæ–½',
              startButton: 'é–‹å§‹ç­†è©¦æ¸¬é©—'
            }
          },
          // æ­·å²æˆç¸¾å…§å®¹
          history: {
            pageTitle: 'æ­·å²æˆç¸¾ - PBLS VRæ•™å­¸å¹³å°',
            title: 'æ­·å²æˆç¸¾',
            subtitle: 'æ­¡è¿ä½¿ç”¨PBLSæ•™å­¸å¹³å°',
            description: 'ä»¥ä¸‹ç‚ºæ¯æ¬¡ç·´ç¿’èˆ‡è€ƒè©¦çš„ç´€éŒ„ï¼š',
            table: {
              date: 'æ—¥æœŸ',
              type: 'é¡åˆ¥',
              score: 'åˆ†æ•¸'
            },
            practice: 'ç·´ç¿’',
            exam: 'è€ƒè©¦'
          },
          // åœ˜éšŠå…§å®¹
          team: {
            pageTitle: 'åœ˜éšŠ - PBLS VRæ•™å­¸å¹³å°',
            title: 'åœ˜éšŠæˆå“¡',
            subtitle: 'æ­¡è¿ä½¿ç”¨PBLSæ•™å­¸å¹³å°',
            description: 'é€™è£¡å±•ç¤ºåœ˜éšŠæˆå“¡ã€è§’è‰²èˆ‡è¯çµ¡æ–¹å¼ã€‚',
            members: {
              member1: {
                name: 'å‘¨å“²æ—­',
                role: 'è·ä½'
              },
              member2: {
                name: 'æ½˜è“æ¨º',
                role: 'è·ä½'
              },
              member3: {
                name: 'é‚±å­èŠ¸',
                role: 'è·ä½'
              },
              member4: {
                name: 'æ—ç«‹å‡¡',
                role: 'è·ä½'
              }
            }
          },
          // ç­†è©¦æ¸¬é©—å…§å®¹
          quiz: {
            pageTitle: 'ç­†è©¦æ¸¬é©— - PBLS VRæ•™å­¸å¹³å°',
            header: {
              title: 'æ­¡è¿ä½¿ç”¨PBLSæ•™å­¸å¹³å°',
              userInfo: 'CGU(é•·åºšå¤§å­¸), Nursing'
            },
            marquee: {
              item1: 'ğŸ¯ æ­¡è¿ä½¿ç”¨PBLS VRæ•™å­¸å¹³å°ï¼',
              item2: 'ğŸ“š 360Â°å¯¦å¢ƒæ•™å­¸å½±ç‰‡ï¼Œèº«è‡¨å…¶å¢ƒçš„å­¸ç¿’é«”é©—',
              item3: 'ğŸ¤– æƒ…å¢ƒæ¨¡æ“¬å°è©±ï¼Œæå‡æ€¥æ•‘æºé€šæŠ€å·§',
              item4: 'ğŸ® VRæ“ä½œæ¸¬é©—ï¼Œæ¨¡æ“¬çœŸå¯¦æ€¥æ•‘æƒ…å¢ƒ',
              item5: 'ğŸ“Š å³æ™‚æˆç¸¾è¿½è¹¤ï¼ŒæŒæ¡å­¸ç¿’é€²åº¦',
              item6: 'ğŸ’¡ å•é¡Œå°å‘å­¸ç¿’æ³•ï¼Œæå‡æ€¥æ•‘æŠ€èƒ½'
            },
            quiz: {
              title: 'ç­†è©¦æ¸¬é©—',
              description: '20é¡Œé¸æ“‡é¡Œï¼Œæ¯é¡Œ5ç§’é˜çš„æ™‚é–“ä½œç­”ï¼Œè«‹æŠŠæ¡å¯¶è²´çš„æ€¥æ•‘æ™‚é–“ï¼Œæ­£ç¢ºåšå‡ºæ‡‰å°æªæ–½',
              startButton: 'é–‹å§‹ç­†è©¦æ¸¬é©—',
              exitConfirmation: 'å°šæœªå®Œæˆç­†è©¦æ¸¬é©—ï¼Œè‹¥ç¾åœ¨é›¢é–‹æ¸¬é©—å°‡ä¸æœƒè¨˜éŒ„ï¼Œç¢ºå®šæ˜¯å¦é›¢é–‹ï¼Ÿ',
              results: {
                score: 'åˆ†',
                correctAnswers: 'ç­”å°é¡Œæ•¸',
                totalQuestions: 'ç¸½é¡Œæ•¸',
                timeUsed: 'ç”¨æ™‚',
                details: 'æ¸¬é©—è©³æƒ…',
                retakeButton: 'é‡æ–°æ¸¬é©—',
                correct: 'æ­£ç¢º',
                incorrect: 'éŒ¯èª¤',
                noAnswer: 'æœªä½œç­”',
                yourAnswer: 'æ‚¨çš„ç­”æ¡ˆï¼š',
                explanation: 'è§£é‡‹',
                correctAnswer: 'æ­£ç¢ºç­”æ¡ˆ'
              }
            }
          }
        },
        // èªè¨€åˆ‡æ›æŒ‰éˆ•
        lang: {
          toggle: 'EN'
        }
      },
      en: {
        menu: {
          info: 'Information',
          practice: 'Practice',
          exam: 'Exam',
          history: 'History',
          team: 'Team'
        },
        content: {
          // é€šç”¨å…§å®¹
          pageTitle: 'Information - PBLS VR Learning Platform',
          header: {
            title: 'Welcome to PBLS Learning Platform',
            userInfo: 'CGU (Chang Gung University), Nursing'
          },
          marquee: {
            item1: 'ğŸ¯ Welcome to PBLS VR Learning Platform!',
            item2: 'ğŸ“š 360Â° Immersive Teaching Videos for Realistic Learning',
            item3: 'ğŸ¤– Virtual Human Interaction to Improve Communication Skills',
            item4: 'ğŸ® VR Practical Operations Simulating Real Emergency Situations',
            item5: 'ğŸ“Š Real-time Score Tracking to Monitor Learning Progress',
            item6: 'ğŸ’¡ Problem-Based Learning to Enhance First Aid Skills'
          },
          // info.html
          hero: {
            title: 'Pediatric Basic Life Support (PBLS)',
            description: 'Pediatric Basic Life Support (PBLS) is the essential guideline for rescuing infants and children in cardiac or respiratory arrest. This platform provides systematic training combining theory, process flow, and scenario simulations.',
            learnMore: 'Learn More'
          },
          flowchart: {
            title: 'PBLS Flowchart',
            altText: 'PBLS Flowchart',
            loadingText: 'PBLS Flowchart image loading...',
            loadingHint: 'Please ensure the image file is in the correct path'
          },
          scenarios: {
            title: 'Simulation Scenario Cases',
            cardiac: 'Cardiac Arrest',
            foodPoisoning: 'Food Poisoning',
            drowning: 'Drowning',
            fireInjury: 'Fire Inhalation Injury',
            trauma: 'Trauma'
          },
          buttons: {
            practice: 'Practice Now',
            exam: 'Enter Exam Test',
            treatment: 'Treatment Measures'
          },
          modal: {
            title: 'Treatment Measures',
            cardiac: {
              title: 'Cardiac Arrest Treatment',
              steps: [
                'Immediately check patient consciousness and breathing',
                'Call emergency services (119)',
                'Begin cardiopulmonary resuscitation (CPR)',
                'Use automated external defibrillator (AED)',
                'Continue CPR until medical professionals arrive'
              ]
            },
            foodPoisoning: {
              title: 'Food Poisoning Treatment',
              steps: [
                'Ensure patient safety, remove from danger',
                'Check patient consciousness and breathing',
                'Clear airway, remove foreign objects',
                'Perform rescue breathing or CPR',
                'Call emergency services and continue monitoring'
              ]
            },
            drowning: {
              title: 'Drowning Treatment',
              steps: [
                'Safely rescue patient from water',
                'Check consciousness and breathing',
                'Clear airway, remove water',
                'Begin cardiopulmonary resuscitation',
                'Call emergency services and keep warm'
              ]
            },
            fireInjury: {
              title: 'Fire Inhalation Injury Treatment',
              steps: [
                'Immediately move away from fire source',
                'Check patient breathing condition',
                'Provide oxygen support',
                'Perform necessary airway management',
                'Call emergency services'
              ]
            },
            trauma: {
              title: 'Trauma Treatment',
              steps: [
                'Ensure scene safety',
                'Assess patient injuries',
                'Control bleeding',
                'Immobilize injured areas',
                'Call emergency services'
              ]
            }
          },
          pageTitle: {
            practice: 'Practice Area',
            exam: 'Exam Area',
            history: 'History',
            team: 'Team'
          },
          // ç·´ç¿’å°ˆå€å…§å®¹
          practice: {
            pageTitle: 'Practice Area - PBLS VR Learning Platform',
            title: 'Practice Area',
            subtitle: 'Welcome to PBLS Learning Platform',
            description: 'This section provides 360Â° immersive teaching videos and virtual human interaction learning.',
            vrVideo: {
              title: '360Â° Immersive Teaching Video',
              description: 'Immersive VR learning experience, allowing you to learn first aid skills in a realistic environment',
              playButton: 'Play VR Video'
            },
            virtualHuman: {
              title: 'Virtual Human Interaction',
              description: 'Practice dialogue with AI-driven virtual patients to improve communication skills'
            },
            quiz: {
              title: 'Practice Questions',
              description: 'Multiple Choice Practice',
              startButton: 'Start Practice'
            }
          },
          // æ¸¬é©—å°ˆå€å…§å®¹
          exam: {
            title: 'Exam Area',
            subtitle: 'Welcome to PBLS Learning Platform',
            vrExam: {
              title: 'VR Practical Operation',
              description: 'First aid operation test in virtual reality environment',
              startButton: 'Start VR Exam'
            },
            writtenExam: {
              title: 'Written Test',
              description: '20 multiple choice questions, 5 seconds per question. Please make the most of your precious first aid time and respond correctly.',
              startButton: 'Start Written Test'
            }
          },
          // æ­·å²æˆç¸¾å…§å®¹
          history: {
            pageTitle: 'History - PBLS VR Learning Platform',
            title: 'History',
            subtitle: 'Welcome to PBLS Learning Platform',
            description: 'Below are the records of each practice and exam:',
            table: {
              date: 'Date',
              type: 'Category',
              score: 'Score'
            },
            practice: 'Practice',
            exam: 'Exam'
          },
          // åœ˜éšŠå…§å®¹
          team: {
            pageTitle: 'Team - PBLS VR Learning Platform',
            title: 'Team Members',
            subtitle: 'Welcome to PBLS Learning Platform',
            description: 'This section displays team members, roles and contact information.',
            members: {
              member1: {
                name: 'Zhou Zhexu',
                role: 'Position'
              },
              member2: {
                name: 'Pan Zhenhua',
                role: 'Position'
              },
              member3: {
                name: 'Qiu Ziyun',
                role: 'Position'
              },
              member4: {
                name: 'Lin Lifan',
                role: 'Position'
              }
            }
          },
          // ç­†è©¦æ¸¬é©—å…§å®¹
          quiz: {
            pageTitle: 'Written Test - PBLS VR Learning Platform',
            header: {
              title: 'Welcome to PBLS Learning Platform',
              userInfo: 'CGU(Chang Gung University), Nursing'
            },
            marquee: {
              item1: 'ğŸ¯ Welcome to PBLS VR Learning Platform!',
              item2: 'ğŸ“š 360Â° immersive teaching videos for realistic learning experience',
              item3: 'ğŸ¤– Virtual human interaction to improve first aid communication skills',
              item4: 'ğŸ® VR practical operation simulating real first aid scenarios',
              item5: 'ğŸ“Š Real-time score tracking to monitor learning progress',
              item6: 'ğŸ’¡ Problem-based learning approach to enhance first aid skills'
            },
            quiz: {
              title: 'Written Test',
              description: '20 multiple choice questions, 5 seconds per question. Please make the most of your precious first aid time and respond correctly.',
              startButton: 'Start Written Test',
              exitConfirmation: 'The written test is not completed yet. If you leave now, the test will not be recorded. Are you sure you want to leave?',
              results: {
                score: 'points',
                correctAnswers: 'Correct Answers',
                totalQuestions: 'Total Questions',
                timeUsed: 'Time Used',
                details: 'Test Details',
                retakeButton: 'Retake Test',
                correct: 'Correct',
                incorrect: 'Incorrect',
                noAnswer: 'No Answer',
                yourAnswer: 'Your answer: ',
                explanation: 'Explanation',
                correctAnswer: 'Correct Answer'
              }
            }
          }
        },
        lang: {
          toggle: 'ä¸­'
        }
      }
    };
    
    this.init();
  }

  init() {
    this.applyLanguage(this.currentLang);
  }

  toggleLanguage() {
    const newLang = this.currentLang === 'zh' ? 'en' : 'zh';
    console.log('toggleLanguage: switching from', this.currentLang, 'to', newLang);
    this.currentLang = newLang;
    localStorage.setItem('pbls_language', newLang);
    this.applyLanguage(newLang);
  }

  applyLanguage(lang) {
    const translation = this.translations[lang];
    
    // æ›´æ–°èªè¨€åˆ‡æ›æŒ‰éˆ•æ–‡å­—
    const languageButton = document.getElementById('language-text');
    if (languageButton) {
      languageButton.textContent = translation.lang.toggle;
    }

    // æ›´æ–°é¸å–®é …ç›®æ–‡å­—
    this.updateMenuItems(translation.menu);

    // æ ¹æ“šç•¶å‰é é¢æ›´æ–°å…§å®¹
    this.updatePageContent(translation.content);

    // æ›´æ–°åœ–ç‰‡è·¯å¾‘
    this.updateImages(lang);
  }

  updateMenuItems(menuTranslation) {
    const menuItems = [
      { selector: '[onclick*="info.html"] span', text: menuTranslation.info },
      { selector: '[onclick*="index.html"] span', text: menuTranslation.practice },
      { selector: '[onclick*="exam.html"] span', text: menuTranslation.exam },
      { selector: '[onclick*="history.html"] span', text: menuTranslation.history },
      { selector: '[onclick*="team.html"] span', text: menuTranslation.team }
    ];

    menuItems.forEach(item => {
      const element = document.querySelector(item.selector);
      if (element) {
        element.textContent = item.text;
      }
    });
  }

  updatePageContent(contentTranslation) {
    const currentPage = this.getCurrentPage();
    
    switch (currentPage) {
      case 'quiz':
        this.updateQuizPage(contentTranslation);
        break;
      case 'info':
        this.updateInfoPage(contentTranslation);
        break;
      case 'index':
        this.updateIndexPage(contentTranslation);
        break;
      case 'exam':
        this.updateExamPage(contentTranslation);
        break;
      case 'history':
        this.updateHistoryPage(contentTranslation);
        break;
      case 'team':
        this.updateTeamPage(contentTranslation);
        break;
    }
  }

  getCurrentPage() {
    const path = window.location.pathname;
    const href = window.location.href;
    console.log('getCurrentPage: path =', path, 'href =', href);
    
    if (path.includes('exam_quiz.html') || href.includes('exam_quiz.html')) {
      console.log('Detected quiz page');
      return 'quiz';
    }
    if (path.includes('info.html') || href.includes('info.html')) return 'info';
    if (path.includes('index.html') || href.includes('index.html')) return 'index';
    if (path.includes('exam.html') || href.includes('exam.html')) return 'exam';
    if (path.includes('history.html') || href.includes('history.html')) return 'history';
    if (path.includes('team.html') || href.includes('team.html')) return 'team';
    
    console.log('No specific page detected, returning default');
    return 'info'; // é»˜èª
  }

  updateInfoPage(content) {
    // æ›´æ–°é é¢æ¨™é¡Œ
    document.title = content.pageTitle;

    // æ›´æ–°é ‚éƒ¨æ¨™é¡Œ
    const headerTitle = document.querySelector('.header-title');
    if (headerTitle) headerTitle.textContent = content.header.title;

    // æ›´æ–°ç”¨æˆ¶ä¿¡æ¯
    const userInfo = document.querySelector('.user-info');
    if (userInfo) userInfo.textContent = content.header.userInfo;

    // æ›´æ–°è·‘é¦¬ç‡ˆå…§å®¹
    const marqueeItems = document.querySelectorAll('.marquee-item');
    if (marqueeItems.length >= 6) {
      marqueeItems[0].textContent = content.marquee.item1;
      marqueeItems[1].textContent = content.marquee.item2;
      marqueeItems[2].textContent = content.marquee.item3;
      marqueeItems[3].textContent = content.marquee.item4;
      marqueeItems[4].textContent = content.marquee.item5;
      marqueeItems[5].textContent = content.marquee.item6;
    }

    // Hero å€å¡Š
    const heroTitle = document.querySelector('.hero-title');
    if (heroTitle) heroTitle.textContent = content.hero.title;

    const heroDescription = document.querySelector('.hero-description');
    if (heroDescription) heroDescription.textContent = content.hero.description;

    const learnMoreBtn = document.querySelector('.learn-more-btn');
    if (learnMoreBtn) learnMoreBtn.textContent = content.hero.learnMore;

    // æµç¨‹åœ–æ¨™é¡Œå’Œç›¸é—œå…§å®¹
    const flowchartTitle = document.querySelector('.section-title');
    if (flowchartTitle) flowchartTitle.textContent = content.flowchart.title;

    const flowchartImg = document.querySelector('.flowchart-image img');
    if (flowchartImg) {
      flowchartImg.alt = content.flowchart.altText;
    }

    const loadingText = document.querySelector('.flowchart-image p');
    if (loadingText) loadingText.textContent = content.flowchart.loadingText;

    const loadingHint = document.querySelector('.flowchart-image p:nth-child(2)');
    if (loadingHint) loadingHint.textContent = content.flowchart.loadingHint;

    // æƒ…å¢ƒæ¨™é¡Œ - ä½¿ç”¨æ­£ç¢ºçš„é¸æ“‡å™¨
    const scenariosTitle = document.querySelector('.section-purple .section-title');
    if (scenariosTitle) scenariosTitle.textContent = content.scenarios.title;

    // æƒ…å¢ƒå¡ç‰‡æ¨™é¡Œ
    const scenarioTitles = document.querySelectorAll('.scenario-title');
    if (scenarioTitles.length >= 5) {
      scenarioTitles[0].textContent = content.scenarios.cardiac;
      scenarioTitles[1].textContent = content.scenarios.foodPoisoning;
      scenarioTitles[2].textContent = content.scenarios.drowning;
      scenarioTitles[3].textContent = content.scenarios.fireInjury;
      scenarioTitles[4].textContent = content.scenarios.trauma;
    }

    // æŒ‰éˆ•æ–‡å­—
    const practiceBtn = document.querySelector('.practice-btn');
    if (practiceBtn) practiceBtn.textContent = content.buttons.practice;

    const examBtn = document.querySelector('.exam-btn');
    if (examBtn) examBtn.textContent = content.buttons.exam;

    // è™•ç†æªæ–½æŒ‰éˆ•
    const treatmentBtns = document.querySelectorAll('.scenario-btn');
    treatmentBtns.forEach(btn => {
      btn.textContent = content.buttons.treatment;
    });

    // æ›´æ–°æ¨¡æ…‹æ¡†æ¨™é¡Œ
    const modalTitle = document.getElementById('modalTitle');
    if (modalTitle) modalTitle.textContent = content.modal.title;
  }

  updateIndexPage(content) {
    // æ›´æ–°é é¢æ¨™é¡Œ
    document.title = content.practice.pageTitle;

    // ç·´ç¿’å°ˆå€é é¢çš„ç¿»è­¯
    const pageTitle = document.querySelector('.header-title');
    if (pageTitle) pageTitle.textContent = content.practice.subtitle;

    // ç·´ç¿’å°ˆå€æ¨™é¡Œ
    const practiceTitle = document.querySelector('.practice-homepage h1');
    if (practiceTitle) practiceTitle.textContent = content.practice.title;

    const practiceDesc = document.querySelector('.practice-homepage > p');
    if (practiceDesc) practiceDesc.textContent = content.practice.description;

    // VR å½±ç‰‡å€å¡Š
    const vrTitle = document.querySelector('.video-title span');
    if (vrTitle) vrTitle.textContent = content.practice.vrVideo.title;

    const vrSubtitle = document.querySelector('.video-subtitle');
    if (vrSubtitle) vrSubtitle.textContent = content.practice.vrVideo.description;

    // è™›æ“¬äººäº’å‹•å€å¡Š
    const virtualHumanTitle = document.querySelector('.virtual-human-section h2');
    if (virtualHumanTitle) {
      virtualHumanTitle.innerHTML = `<i class="fas fa-comment-dots"></i> ${content.practice.virtualHuman.title}`;
    }

    const virtualHumanDesc = document.querySelector('.virtual-human-section p');
    if (virtualHumanDesc) virtualHumanDesc.textContent = content.practice.virtualHuman.description;

    // è·‘é¦¬ç‡ˆå…§å®¹
    const marqueeItems = document.querySelectorAll('.marquee-item');
    if (marqueeItems.length >= 6) {
      marqueeItems[0].textContent = content.marquee.item1;
      marqueeItems[1].textContent = content.marquee.item2;
      marqueeItems[2].textContent = content.marquee.item3;
      marqueeItems[3].textContent = content.marquee.item4;
      marqueeItems[4].textContent = content.marquee.item5;
      marqueeItems[5].textContent = content.marquee.item6;
    }
  }

  updateExamPage(content) {
    // æ¸¬é©—å°ˆå€é é¢çš„ç¿»è­¯
    const pageTitle = document.querySelector('.header-title');
    if (pageTitle) pageTitle.textContent = content.exam.subtitle;

    // æ¸¬é©—å°ˆå€æ¨™é¡Œ
    const examTitle = document.querySelector('.exam-homepage h1');
    if (examTitle) examTitle.textContent = content.exam.title;

    const examDesc = document.querySelector('.exam-homepage > p');
    if (examDesc) examDesc.textContent = content.exam.subtitle;

    // ç­†è©¦å¡ç‰‡ (ç¬¬ä¸€å€‹)
    const writtenExamTitle = document.querySelector('.exam-option-card:nth-child(1) h3');
    if (writtenExamTitle) writtenExamTitle.textContent = content.exam.writtenExam.title;

    const writtenExamDesc = document.querySelector('.exam-option-card:nth-child(1) p');
    if (writtenExamDesc) writtenExamDesc.textContent = content.exam.writtenExam.description;

    const writtenExamBtn = document.querySelector('.exam-option-card:nth-child(1) .exam-btn');
    if (writtenExamBtn) writtenExamBtn.textContent = content.exam.writtenExam.startButton;

    // VR è€ƒè©¦å¡ç‰‡ (ç¬¬äºŒå€‹)
    const vrExamTitle = document.querySelector('.exam-option-card:nth-child(2) h3');
    if (vrExamTitle) vrExamTitle.textContent = content.exam.vrExam.title;

    const vrExamDesc = document.querySelector('.exam-option-card:nth-child(2) p');
    if (vrExamDesc) vrExamDesc.textContent = content.exam.vrExam.description;

    const vrExamBtn = document.querySelector('.exam-option-card:nth-child(2) .exam-btn');
    if (vrExamBtn) vrExamBtn.textContent = content.exam.vrExam.startButton;

    // è·‘é¦¬ç‡ˆå…§å®¹
    const marqueeItems = document.querySelectorAll('.marquee-item');
    if (marqueeItems.length >= 6) {
      if (this.currentLang === 'en') {
        marqueeItems[0].textContent = 'ğŸ¯ Welcome to PBLS VR Learning Platform!';
        marqueeItems[1].textContent = 'ğŸ“š 360Â° Immersive Teaching Videos for Realistic Learning';
        marqueeItems[2].textContent = 'ğŸ¤– Virtual Human Interaction to Improve Communication Skills';
        marqueeItems[3].textContent = 'ğŸ® VR Practical Operations Simulating Real Emergency Situations';
        marqueeItems[4].textContent = 'ğŸ“Š Real-time Score Tracking to Monitor Learning Progress';
        marqueeItems[5].textContent = 'ğŸ’¡ Problem-Based Learning to Enhance First Aid Skills';
      } else {
        marqueeItems[0].textContent = 'ğŸ¯ æ­¡è¿ä½¿ç”¨PBLS VRæ•™å­¸å¹³å°ï¼';
        marqueeItems[1].textContent = 'ğŸ“š 360Â°å¯¦å¢ƒæ•™å­¸å½±ç‰‡ï¼Œèº«è‡¨å…¶å¢ƒçš„å­¸ç¿’é«”é©—';
        marqueeItems[2].textContent = 'ğŸ¤– è™›æ“¬äººäº’å‹•ï¼Œæå‡æ€¥æ•‘æºé€šæŠ€å·§';
        marqueeItems[3].textContent = 'ğŸ® VRæ“ä½œæ¸¬é©—ï¼Œæ¨¡æ“¬çœŸå¯¦æ€¥æ•‘æƒ…å¢ƒ';
        marqueeItems[4].textContent = 'ğŸ“Š å³æ™‚æˆç¸¾è¿½è¹¤ï¼ŒæŒæ¡å­¸ç¿’é€²åº¦';
        marqueeItems[5].textContent = 'ğŸ’¡ å•é¡Œå°å‘å­¸ç¿’æ³•ï¼Œæå‡æ€¥æ•‘æŠ€èƒ½';
      }
    }
  }

  updateHistoryPage(content) {
    // æ›´æ–°é é¢æ¨™é¡Œ
    document.title = content.history.pageTitle;

    // æ­·å²æˆç¸¾é é¢çš„ç¿»è­¯
    const pageTitle = document.querySelector('.header-title');
    if (pageTitle) pageTitle.textContent = content.history.subtitle;

    // æ­·å²æˆç¸¾æ¨™é¡Œ
    const historyTitle = document.querySelector('.history-page h1');
    if (historyTitle) historyTitle.textContent = content.history.title;

    const historyDesc = document.querySelector('.history-page > p');
    if (historyDesc) historyDesc.textContent = content.history.description;

    // è¡¨æ ¼æ¨™é¡Œ
    const tableHeaders = document.querySelectorAll('.history-page table th');
    if (tableHeaders.length >= 3) {
      tableHeaders[0].textContent = content.history.table.date;
      tableHeaders[1].textContent = content.history.table.type;
      tableHeaders[2].textContent = content.history.table.score;
    }

    // è¡¨æ ¼å…§å®¹
    const tableCells = document.querySelectorAll('.history-page table td');
    if (tableCells.length >= 6) {
      // ç¬¬äºŒè¡Œï¼šç·´ç¿’
      tableCells[3].textContent = content.history.practice;
      // ç¬¬ä¸‰è¡Œï¼šè€ƒè©¦
      tableCells[4].textContent = content.history.exam;
    }

    // è·‘é¦¬ç‡ˆå…§å®¹
    const marqueeItems = document.querySelectorAll('.marquee-item');
    if (marqueeItems.length >= 6) {
      marqueeItems[0].textContent = content.marquee.item1;
      marqueeItems[1].textContent = content.marquee.item2;
      marqueeItems[2].textContent = content.marquee.item3;
      marqueeItems[3].textContent = content.marquee.item4;
      marqueeItems[4].textContent = content.marquee.item5;
      marqueeItems[5].textContent = content.marquee.item6;
    }
  }

  updateQuizPage(content) {
    console.log('updateQuizPage called with content:', content);
    
    // æ›´æ–°é é¢æ¨™é¡Œ
    document.title = content.quiz.pageTitle;
    console.log('Page title updated to:', content.quiz.pageTitle);

    // æ›´æ–°é ‚éƒ¨æ¨™é¡Œ
    const headerTitle = document.querySelector('.header-title');
    if (headerTitle) {
      headerTitle.textContent = content.quiz.header.title;
      console.log('Header title updated to:', content.quiz.header.title);
    } else {
      console.log('Header title element not found');
    }

    // æ›´æ–°ç”¨æˆ¶ä¿¡æ¯
    const userInfo = document.querySelector('.user-info');
    if (userInfo) {
      userInfo.textContent = content.quiz.header.userInfo;
      console.log('User info updated to:', content.quiz.header.userInfo);
    } else {
      console.log('User info element not found');
    }

    // æ›´æ–°è·‘é¦¬ç‡ˆå…§å®¹
    const marqueeItems = document.querySelectorAll('.marquee-item');
    if (marqueeItems.length >= 6) {
      marqueeItems[0].textContent = content.quiz.marquee.item1;
      marqueeItems[1].textContent = content.quiz.marquee.item2;
      marqueeItems[2].textContent = content.quiz.marquee.item3;
      marqueeItems[3].textContent = content.quiz.marquee.item4;
      marqueeItems[4].textContent = content.quiz.marquee.item5;
      marqueeItems[5].textContent = content.quiz.marquee.item6;
    }

    // æ›´æ–°ç­†è©¦æ¸¬é©—ç›¸é—œå…§å®¹
    const quizTitle = document.querySelector('.quiz-title');
    if (quizTitle) quizTitle.textContent = content.quiz.quiz.title;

    const quizDescription = document.querySelector('.quiz-description');
    if (quizDescription) quizDescription.textContent = content.quiz.quiz.description;

    const startButton = document.querySelector('.start-quiz-btn');
    if (startButton) startButton.textContent = content.quiz.quiz.startButton;

    // æ›´æ–°æ¸¬é©—çµæœç›¸é—œæ–‡å­—ï¼ˆé€™äº›æ˜¯å‹•æ…‹ç”Ÿæˆçš„ï¼Œéœ€è¦åœ¨JavaScriptä¸­è™•ç†ï¼‰
    // é€™è£¡æˆ‘å€‘å°‡æ›´æ–°å…¨å±€è®Šé‡ï¼Œä»¥ä¾¿åœ¨ç”Ÿæˆçµæœæ™‚ä½¿ç”¨æ­£ç¢ºçš„èªè¨€
    window.quizTranslations = content.quiz.quiz.results;
    window.quizExitMessage = content.quiz.quiz.exitConfirmation;
    
    // å¦‚æœæ¸¬é©—å°šæœªé–‹å§‹ï¼Œé‡æ–°è¼‰å…¥å°æ‡‰èªè¨€çš„é¡Œç›®
    if (typeof loadQuestions === 'function' && !window.isQuizActive) {
      loadQuestions();
    }
    
    // å‹•æ…‹æ›´æ–°æ¸¬é©—æè¿°ï¼Œé¡¯ç¤ºå¯¦éš›é¡Œç›®æ•¸é‡
    updateQuizDescription();
  }

  updateQuizDescription() {
    // é€™å€‹å‡½æ•¸æœƒåœ¨ exam_quiz.html ä¸­è¢«å®šç¾©å’Œèª¿ç”¨
    // ç”¨æ–¼å‹•æ…‹æ›´æ–°æ¸¬é©—æè¿°æ–‡å­—
    if (typeof window.updateQuizDescriptionText === 'function') {
      window.updateQuizDescriptionText();
    }
  }

  updateTeamPage(content) {
    // æ›´æ–°é é¢æ¨™é¡Œ
    document.title = content.team.pageTitle;

    // åœ˜éšŠé é¢çš„ç¿»è­¯
    const pageTitle = document.querySelector('.header-title');
    if (pageTitle) pageTitle.textContent = content.team.subtitle;

    // åœ˜éšŠæ¨™é¡Œ
    const teamTitle = document.querySelector('.team-page h1');
    if (teamTitle) teamTitle.textContent = content.team.title;

    const teamDesc = document.querySelector('.team-page > p');
    if (teamDesc) teamDesc.textContent = content.team.description;

    // åœ˜éšŠæˆå“¡ä¿¡æ¯
    const memberCards = document.querySelectorAll('.team-member-card');
    if (memberCards.length >= 4) {
      // å‘¨å“²æ—­
      const member1Name = memberCards[0].querySelector('.member-name');
      const member1Role = memberCards[0].querySelector('.member-role');
      if (member1Name) member1Name.textContent = content.team.members.member1.name;
      if (member1Role) member1Role.textContent = content.team.members.member1.role;

      // æ½˜è“æ¨º
      const member2Name = memberCards[1].querySelector('.member-name');
      const member2Role = memberCards[1].querySelector('.member-role');
      if (member2Name) member2Name.textContent = content.team.members.member2.name;
      if (member2Role) member2Role.textContent = content.team.members.member2.role;

      // é‚±å­èŠ¸
      const member3Name = memberCards[2].querySelector('.member-name');
      const member3Role = memberCards[2].querySelector('.member-role');
      if (member3Name) member3Name.textContent = content.team.members.member3.name;
      if (member3Role) member3Role.textContent = content.team.members.member3.role;

      // æ—ç«‹å‡¡
      const member4Name = memberCards[3].querySelector('.member-name');
      const member4Role = memberCards[3].querySelector('.member-role');
      if (member4Name) member4Name.textContent = content.team.members.member4.name;
      if (member4Role) member4Role.textContent = content.team.members.member4.role;
    }

    // è·‘é¦¬ç‡ˆå…§å®¹
    const marqueeItems = document.querySelectorAll('.marquee-item');
    if (marqueeItems.length >= 6) {
      marqueeItems[0].textContent = content.marquee.item1;
      marqueeItems[1].textContent = content.marquee.item2;
      marqueeItems[2].textContent = content.marquee.item3;
      marqueeItems[3].textContent = content.marquee.item4;
      marqueeItems[4].textContent = content.marquee.item5;
      marqueeItems[5].textContent = content.marquee.item6;
    }
  }

  updateImages(lang) {
    // æµç¨‹åœ–åœ–ç‰‡ - æš«æ™‚ä½¿ç”¨ç›¸åŒåœ–ç‰‡ï¼Œå› ç‚ºè‹±æ–‡ç‰ˆæœ¬åœ–ç‰‡ä¸å­˜åœ¨
    const flowchartImg = document.querySelector('.flowchart-image img');
    if (flowchartImg) {
      flowchartImg.src = '/PBLSæµç¨‹åœ–.png';
    }

    // æƒ…å¢ƒåœ–ç‰‡ - ä½¿ç”¨ç›¸åŒçš„ä¸­æ–‡åœ–ç‰‡ï¼Œå› ç‚ºè‹±æ–‡ç‰ˆæœ¬åœ–ç‰‡ä¸å­˜åœ¨
    const scenarioImages = document.querySelectorAll('.scenario-image img');
    const scenarios = ['å¿ƒè‡Ÿé©Ÿåœ', 'é£Ÿç‰©ä¸­æ¯’', 'æººæ°´', 'ç«ç½å—†å‚·', 'å¤–å‚·'];
    scenarioImages.forEach((img, index) => {
      if (scenarios[index]) {
        // å§‹çµ‚ä½¿ç”¨ä¸­æ–‡ç‰ˆæœ¬çš„åœ–ç‰‡ï¼Œå› ç‚ºè‹±æ–‡ç‰ˆæœ¬åœ–ç‰‡ä¸å­˜åœ¨
        img.src = `assets/${scenarios[index]}æƒ…å¢ƒ.png`;
      }
    });
  }
}

// å‰µå»ºå…¨å±€å¯¦ä¾‹
window.languageSwitcher = new LanguageSwitcher();

// å…¨å±€å‡½æ•¸ä¾› HTML èª¿ç”¨
window.toggleLanguage = function() {
  window.languageSwitcher.toggleLanguage();
};

// é é¢è¼‰å…¥æ™‚æ‡‰ç”¨èªè¨€
document.addEventListener('DOMContentLoaded', function() {
  if (window.languageSwitcher) {
    window.languageSwitcher.applyLanguage(window.languageSwitcher.currentLang);
  }
});
